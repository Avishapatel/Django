{% extends 'index.html' %}


{% block content %}
    <!-- Navbar Start -->
    <div class="container-fluid mb-4">
        <div class="row border-top px-xl-5">
            <div class="col-lg-3 d-none d-lg-block">
                <a class="btn shadow-none d-flex align-items-center justify-content-between bg-primary text-white w-100" data-toggle="collapse" href="#navbar-vertical" style="height: 65px; margin-top: -1px; padding: 0 30px;">
                    <h6 class="m-0">Categories</h6>
                    <i class="fa fa-angle-down text-dark"></i>
                </a>
                <nav class="collapse position-absolute navbar navbar-vertical navbar-light align-items-start p-0 border border-top-0 border-bottom-0 bg-light" id="navbar-vertical" style="width: calc(100% - 30px); z-index: 1;">
                    <div class="navbar-nav w-100 overflow-hidden" style="height: 530px">
                        {% for i in c_id %}
                        <div class="nav-item dropdown">
                            <a href="#" class="nav-link" data-toggle="dropdown">{{ i.cat_name }} <i class="fa fa-angle-down float-right mt-1"></i></a>
                            <div class="dropdown-menu position-absolute bg-secondary border-0 rounded-0 w-100 m-0">
                                {% for sub in i.sub_category_set.all %}
                                    <a href="{% url 'shop' %}?s_id={{ sub.id }}" class="dropdown-item">{{ sub.sbcat_name }}</a>
                                {% empty %}
                                    <span class="dropdown-item disabled">No subcategories</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                       
                    </div>
                </nav>
            </div>
            <div class="col-lg-9">
                <nav class="navbar navbar-expand-lg bg-light navbar-light py-3 py-lg-0 px-0">
                    <a href="" class="text-decoration-none d-block d-lg-none">
                        <h1 class="m-0 display-5 font-weight-semi-bold"><span class="text-primary font-weight-bold border px-3 mr-1">E</span>Shopper</h1>
                    </a>
                    <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
                        <div class="navbar-nav mr-auto py-0">
                            <a href="{% url 'index' %}" class="nav-item nav-link">Home</a>
                            <a href="{% url 'shop' %}" class="nav-item nav-link">Shop</a>
                            <a href="{% url 'detail' %}" class="nav-item nav-link">Shop Detail</a>
                            <div class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Pages</a>
                                <div class="dropdown-menu rounded-0 m-0">
                                    <a href="{% url 'cart' %}" class="dropdown-item">Shopping Cart</a>
                                    <a href="{% url 'checkout' %}" class="dropdown-item">Checkout</a>
                                    <a href="{% url 'wishlist' %}"class="dropdown-item">Wishlist</a>
                                    <a href="{% url 'my_orders' %}"class="dropdown-item">My Orders</a>
                                </div>
                            </div>
                            <a href="{% url 'contact' %}" class="nav-item nav-link">Contact</a>
                        </div>
                        <div class="navbar-nav ml-auto py-0">
                            {% if request.session.user_name %}
                                <a href="{% url 'profile' %}" class="nav-item nav-link">Hi, {{ request.session.user_name }}</a>
                                <a href="{% url 'logout' %}" class="nav-item nav-link">Logout</a>  <!-- <-- use logout URL -->
                            {% else %}
                                <a href="{% url 'login' %}" class="nav-item nav-link">Login</a>
                                <a href="{% url 'register' %}" class="nav-item nav-link">Register</a>
                            {% endif %}
                        </div>
                    </div>
                </nav>
{% if messages %}
<div class="container mt-3">
    {% for message in messages %}
        {% if 'logout' in message.tags %}
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <script>
                setTimeout(function() {
                    $('.alert').fadeOut('slow', function() { $(this).remove(); });
                }, 3000);  <!-- auto-dismiss after 3 seconds -->
            </script>
        {% endif %}
    {% endfor %}
</div>
{% endif %}

            </div>
        </div>
    </div>
    <!-- Navbar End -->


    <!-- Page Header Start -->
    <div class="container-fluid bg-secondary">
        <div class="d-flex flex-column align-items-center justify-content-center" style="min-height: 200px">
            <h2 class="font-weight-semi-bold text-uppercase mb-3">Order Details</h2>
            <div class="d-inline-flex">
                <p class="m-0"><a href="{% url 'index' %}">Home</a></p>
                <p class="m-0 px-2">-</p>
                <p class="m-0">Order Details</p>
            </div>
        </div>
    </div>
    <!-- Page Header End -->

 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/fontawesome.min.css" integrity="sha512-M5Kq4YVQrjg5c2wsZSn27Dkfm/2ALfxmun0vUE3mPiJyK53hQBHYCVAtvMYEC7ZXmYLg8DVG4tF8gD27WmDbsg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
              


<div class="container my-5">

  <!-- ====== ORDER HEADER ====== -->
  <div class="card border-0 shadow-lg mb-4 p-3" style="border-radius: 15px; min-height: 140px;">
    <div class="d-flex justify-content-between align-items-center flex-wrap">
      <div>
        <h4 class="font-weight-bold mb-1">Order <span class="text-primary">#{{ order.order_id }}</span></h4>
        <small class="text-muted d-block">
          {{ order.order_date|date:"d M Y" }} ‚Ä¢ {{ order.payment_mode }}
        </small>
      </div>
      <span class="badge badge-pill px-4 py-2 font-weight-bold
        {% if order.order_status == 'Pending' %}badge-warning
        {% elif order.order_status == 'Shipped' %}badge-info
        {% elif order.order_status == 'Delivered' %}badge-success
        {% elif order.order_status == 'Cancelled' %}badge-danger
        {% else %}badge-secondary{% endif %}
      ">
        {{ order.order_status }}
      </span>
    </div>

    <!-- ====== ORDER STATUS STEPPER ====== -->
    <div class="mt-3">
      <div class="d-flex justify-content-between position-relative" style="height: 12px;">
        <!-- Step backgrounds -->
        <div class="bg-light" style="position:absolute; top:4px; left:0; width:100%; height:4px; border-radius:2px;"></div>
        <!-- Step progress -->
        {% if order.order_status == 'Pending' %}
        <div class="bg-warning" style="position:absolute; top:4px; left:0; width:30%; height:4px; border-radius:2px;"></div>
        {% elif order.order_status == 'Shipped' %}
        <div class="bg-info" style="position:absolute; top:4px; left:0; width:60%; height:4px; border-radius:2px;"></div>
        {% elif order.order_status == 'Delivered' %}
        <div class="bg-success" style="position:absolute; top:4px; left:0; width:100%; height:4px; border-radius:2px;"></div>
        {% elif order.order_status == 'Cancelled' %}
        <div class="bg-danger" style="position:absolute; top:4px; left:0; width:100%; height:4px; border-radius:2px;"></div>
        {% endif %}

        <!-- Step icons -->
        <div class="d-flex justify-content-between position-relative mt-3" >
          <div class="text-center">
            <i class="fas fa-clock text-warning"></i>
            <small style="margin-right: 15px;">Pending</small>
          </div>
          <div class="text-center">
            <i class="fas fa-truck text-info"></i>
            <small style="margin-right: 15px;">Shipped</small>
          </div>
          <div class="text-center">
            <i class="fas fa-check-circle text-success"></i>
            <small style="margin-right: 15px;">Delivered</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">

    <!-- ====== SHIPPING ADDRESS ====== -->
    <div class="col-lg-4 mb-4">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-white font-weight-bold">üìç Shipping Address</div>
        <div class="card-body">
          <p class="mb-1 font-weight-bold">{{ order.billing_address.first_name }} {{ order.billing_address.last_name }}</p>
          <p class="mb-1">{{ order.billing_address.address_l1 }}, {{ order.billing_address.address_l2 }}</p>
          <p class="mb-1">{{ order.billing_address.city }}, {{ order.billing_address.state }}</p>
          <p class="mb-1">Pincode: {{ order.billing_address.zip_code }}</p>
          <p class="mb-0 text-muted">üìû {{ order.billing_address.phone_no }}</p>
        </div>
      </div>
    </div>

    <!-- ====== PRODUCTS ====== -->
    <div class="col-lg-8 mb-4">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white font-weight-bold">üõí Items Ordered</div>
        <div class="table-responsive">
          <table class="table mb-0 align-middle">
            <thead class="bg-light">
              <tr>
                <th>Product</th>
                <th class="text-center">Price</th>
                <th class="text-center">Qty</th>
                <th class="text-right">Amount</th>
              </tr>
            </thead>
            <tbody>
              {% for item in order_items %}
              <tr>
                <td class="d-flex align-items-center">
                  <!-- optional: thumbnail image -->
                  {% if item.product.image %}
                  <img src="{{ item.product.image.url }}" alt="" class="img-fluid mr-2" style="width:40px;height:40px; object-fit:cover; border-radius:5px;">
                  {% endif %}
                  <span class="font-weight-bold">{{ item.product.product_name }}</span>
                </td>
                <td class="text-center" style="font-weight: 500;"><i class="fa-solid fa-indian-rupee-sign"></i>{{ item.product.product_price }}</td>
                <td class="text-center"><span class="badge badge-light px-3" style="font-size: 15px;">{{ item.quantity }}</span></td>
                <td class="text-right font-weight-bold text-primary"><i class="fa-solid fa-indian-rupee-sign"></i>{{ item.price }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

  <!-- ====== BILL SUMMARY ====== -->
  <div class="row">
    <div class="col-lg-5 ml-auto">
      <div class="card border-0 shadow-lg" style="border-radius:15px; background:linear-gradient(145deg,#ffffff,#e9f2ff);">
        <div class="card-body">
          <h5 class="font-weight-bold mb-3">üí≥ Price Details</h5>
          <div class="d-flex justify-content-between mb-2" style="font-weight: 500;"><span>Subtotal</span><span><i class="fa-solid fa-indian-rupee-sign"></i>{{ order.sub_total }}</span></div>
          <div class="d-flex justify-content-between mb-2" style="font-weight: 500;"><span>Shipping</span><span style="color: red;">+<i class="fa-solid fa-indian-rupee-sign"></i>{{ order.shipping_charge }}</span></div>
          {% if order.discount %}
          <div class="d-flex justify-content-between mb-2" style="font-weight: 500;"><span>Discount <span style="color: blue; margin-left: 15px;">({{ order.discount_percentage }}%)</span></span><span style="color: green;">-<i class="fa-solid fa-indian-rupee-sign"></i>{{ order.discount }}</span></div>
          {% endif %}
          {% if order.coupon_discount %}
          <div class="d-flex justify-content-between mb-2" style="font-weight: 500;"><span>Coupon Applied</span><span style="color: green;">-<i class="fa-solid fa-indian-rupee-sign"></i>{{ order.coupon_discount }}</span></div>
          {% endif %}
          <hr>
          <div class="d-flex justify-content-between align-items-center">
            <span class="h6 font-weight-bold">Total Payable</span>
            <span class="h4 font-weight-bold text-primary"><i class="fa-solid fa-indian-rupee-sign"></i>{{ order.bill_amount }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ====== ACTION BUTTON ====== -->
  <div class="text-center mt-4">
    <a href="{% url 'my_orders' %}" class="btn btn-lg btn-primary px-5" style="border-radius:30px;">‚Üê Back to Orders</a>
  </div>

</div>



{% endblock %}

